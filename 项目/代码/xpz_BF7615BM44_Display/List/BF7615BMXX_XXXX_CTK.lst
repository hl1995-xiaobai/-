C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE BF7615BMXX_XXXX_CTK
OBJECT MODULE PLACED IN .\Output\BF7615BMXX_XXXX_CTK.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE BF7615BMXX_XXXX_Library\BF7615BMXX_XXXX_CTK_Lib\BF7615BMXX_XXXX_CTK.c OM
                    -F2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Application_Library;.\BF7615BMXX_XXXX_Library;.\Code;.\Project) DEBUG PRINT(.\List\
                    -BF7615BMXX_XXXX_CTK.lst) TABS(2) OBJECT(.\Output\BF7615BMXX_XXXX_CTK.obj)

line level    source

   1          #include ".\BF7615BMXX_XXXX_Library\Config.h"
   2          
   3          unsigned int  xdata raw_data[CH_MAX] ={0};
   4          unsigned int  xdata base_line[CH_MAX] = {1};
   5          
   6          #if SNS_NUM
   7            unsigned char xdata Mode = 0;
   8            unsigned char  sns_next = 0;
   9            static unsigned char xdata adjust_count = 0;
  10          
  11            #if (CS_SW == 1)
                  uint cs_noise = 0;
                #endif
  14          
  15            bit adjust_done_flag = 0;
  16            bit ctk_circle_done = 0;
  17            bit ctk_start_flag = 0;
  18          
  19            unsigned int xdata pull_i_value_parallel = 255;
  20            unsigned long xdata open_sns_l = 0;
  21            unsigned long xdata open_sns_h = 0;
  22          
  23            unsigned char xdata parallel_mode = 0;
  24            bit parallel_init_flag = 1;
  25            bit ctk_para_done = 0;
  26            unsigned int  xdata ctk_soft_reset_count = 0;
  27          
  28            unsigned long xdata muli_key_flag_l = 0;
  29            unsigned long xdata muli_key_flag_h = 0;
  30            
  31            unsigned long xdata keys_flag_l = 0;  
  32            unsigned long xdata keys_flag_h = 0;  
  33            unsigned long xdata mode_flag_l = 0;
  34            unsigned long xdata mode_flag_h = 0;  
  35            
  36            unsigned long xdata sensor_flag_l = 0;  
  37            unsigned long xdata sensor_flag_h = 0;  
  38            unsigned int  xdata long_key_clear_count = 0;   
  39          
  40            
  41            unsigned char xdata multi_key_count = 0;
  42            unsigned char xdata multi_key_reset_cnt = 0;
  43          
  44            #if (RENOVATE_MODE == 1)
                bit water_flow_flag = 0;  
                unsigned int  xdata water_flow_left_count = 0;  
                unsigned char xdata water_flow_key_count = 0; 
                unsigned char xdata water_flow_key_reset_cnt = 0;
                #endif
  50            
  51          
  52            #if UN_NORMAL_CHECK
                    unsigned char xdata un_normal_count = 0;
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 2   

                    unsigned char xdata un_normal_recover_count = 0;
                    bit un_normal_flag = 0;
                    unsigned long xdata adjust_flag = 0;
                #endif
  58            
  59            void CTK_BF7615BMXX_XXXX_Adjust_Int(void);
  60            void CTK_BF7615BMXX_XXXX_Para_Adjust_Int(void);
  61            void CTK_BF7615BMXX_XXXX_Get_KEYS_Touch(unsigned char sns);
  62            void Base_Line_Init();
  63            void Set_Next_SNS(void);
  64          
  65          #if IDLE_MODE
                
                //-----------------------------------------------------------------//
                //º¯ÊýÃû³Æ£º void Set_Para_SNS(void)
                //º¯Êý¹¦ÄÜ£º ÉèÖÃ²¢ÁªÄ£Ê½Í¨µÀ
                //ÊäÈë²ÎÊý£º ÎÞ
                //Êä³ö²ÎÊý£º ÎÞ
                //·µ »Ø Öµ£º ÎÞ
                //-----------------------------------------------------------------// 
                void Set_Para_SNS(void)
                {
                    CTK_PAR_SET(1);           //0Îªµ¥Í¨µÀÄ£Ê½£¬1Îª¶àÍ¨µÀ²¢ÁªÄ£Ê½
                    CTK_PULL_I_SET(pull_i_value_parallel);//ÉèÖÃ¼¶Êý
                    CTK_RESO_SET(CTK_PARA_RESO); 
                    CTK_PRS_SET(CTK_PARA_PRS);
                    CTK_RB_SET(CTK_PARA_RB);  
                    CTK_VTH_SET(CTK_PARA_REF);  
                    CTK_ADDR_SET(sensor_open[0]);
                    CTK_START;
                }
                
                //-----------------------------------------------------------------//
                //º¯ÊýÃû³Æ£º void CTK_BF7615BMXX_XXXX_Para_Adjust_Int(void)
                //º¯Êý¹¦ÄÜ£º²¢ÁªÄ£Ê½Í¨µÀµçÁ÷Ô´×ÔÊÊÓ¦
                //ÊäÈë²ÎÊý£º ÎÞ
                //Êä³ö²ÎÊý£º ÎÞ
                //·µ »Ø Öµ£º ÎÞ
                //-----------------------------------------------------------------//        
              
                void CTK_BF7615BMXX_XXXX_Para_Adjust_Int(void)
                {
                  if(adjust_count < 3)
                  {
                    while(1)
                    {
                      WDT_CTRL = 7;
                      
                      if((raw_data_parallel[0] >= ADJUST_PARA_LINE))
                      {
                        if(pull_i_value_parallel < (511 - ADJUST_STE))
                        {
                          pull_i_value_parallel += (1 + ADJUST_STE);
                          
                          
                          Set_Para_SNS();
                          return;
                        } 
                        else
                        {
                          parallel_init_flag = 1;
                          base_line_parallel[0] = raw_data_parallel[0];           
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 3   

                          Set_Next_SNS();
                          return;
                        }
                      }
                      else
                      { 
                          if(adjust_count < 3)
                          {
                            adjust_count++;
                          }
              
                          if(pull_i_value_parallel > (0))
                          {
                            pull_i_value_parallel-= (1);
                            
                            Set_Para_SNS();
                            
                            return;
                          }
                          else
                          {
                              Set_Para_SNS();
                              return;
                          } 
                      }
                    }
                  }
                  
                  if(adjust_count >= 3)
                  {
                    while(1)
                    {
                      WDT_CTRL = 7;
                      
                      if((raw_data_parallel[0] <= ADJUST_PARA_LINE))
                      {
                        if(pull_i_value_parallel > (0))
                        {
                          pull_i_value_parallel -= (1);
                        
                          Set_Para_SNS();
                          return;
                        } 
                        else
                        {
                          parallel_init_flag = 1;
                          base_line_parallel[0] = raw_data_parallel[0];
                          Set_Next_SNS();
                          return;
                        }
                      }
                      else
                      { 
                          if(adjust_count < 6)
                          {
                            adjust_count++;
                          }
                          if(adjust_count >= 6)
                          {
                            adjust_count = 0;
                            parallel_init_flag = 1;
                            base_line_parallel[0] = raw_data_parallel[0];           
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 4   

                            Set_Next_SNS();
                            return;
                          }
              
                          if(pull_i_value_parallel < (511 - ADJUST_STE))
                          {
                            pull_i_value_parallel += (1 + ADJUST_STE);
              
                            Set_Para_SNS();
                            return;
                          }
                          else
                          {
                              Set_Para_SNS();
                              return;
                          } 
                      }
                    }
                  }
                }
                #endif
 199            
 200          //-----------------------------------------------------------------//
 201          //º¯ÊýÃû³Æ£º void CTK_Set_Para(void)
 202          //º¯Êý¹¦ÄÜ£º ÉèÖÃCTKÉ¨Ãè²ÎÊý¼°»ùÏß¸üÐÂ²ÎÊý
 203          //ÊäÈë²ÎÊý£º ÎÞ
 204          //Êä³ö²ÎÊý£º ÎÞ
 205          //·µ »Ø Öµ£º ÎÞ
 206          //-----------------------------------------------------------------//
 207          void CTK_Set_Para(void)
 208          {
 209   1      
 210   1          unsigned char i = 0;
 211   1            
 212   1          for (i = 0; i < SNS_NUM; i++)
 213   1          {
 214   2              sensor_open[i] = SNS[i];
 215   2              
 216   2              if(sensor_open[i] < 32)
 217   2              {
 218   3                open_sns_l |= ((ulong)0x01)<<sensor_open[i];
 219   3              }
 220   2              else
 221   2              {
 222   3                open_sns_h |= ((ulong)0x01)<<(sensor_open[i] - 32);
 223   3              }
 224   2              //Í¨µÀÅäÖÃ
 225   2            
 226   2              pull_i_value[i] = PUIV[sensor_open[i]];//µçÁ÷Ô´¼¶Êý;
 227   2              raw_data[i] = 0;
 228   2              //ÉÏÀ­µçÁ÷Ô´³õÊ¼»¯
 229   2          }
 230   1      
 231   1          
 232   1      }
 233          //-----------------------------------------------------------------//
 234          //º¯ÊýÃû³Æ£º void Set_Next_SNS(void)
 235          //º¯Êý¹¦ÄÜ£º ÉèÖÃÏÂÒ»¸öÍ¨µÀ
 236          //ÊäÈë²ÎÊý£º ÎÞ
 237          //Êä³ö²ÎÊý£º ÎÞ
 238          //·µ »Ø Öµ£º ÎÞ
 239          //-----------------------------------------------------------------// 
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 5   

 240          void Set_Next_SNS(void)
 241          {
 242   1        CTK_BF7615BMXX_XXXX_Set_Para(pull_i_value[sns_next]);
 243   1        CTK_ADDR_SET(sensor_open[sns_next]);
 244   1        #if IDLE_MODE
                  CTK_PAR_SET(0);           //0Îªµ¥Í¨µÀÄ£Ê½£¬1Îª¶àÍ¨µÀ²¢ÁªÄ£Ê½
                  CTK_RESO_SET(CTK_RESO); 
                  CTK_PRS_SET(CTK_PRS); 
                  CTK_VTH_SET(CTK_REF); 
                  CTK_RB_SET(CTK_RB); 
                #endif
 251   1        
 252   1        CTK_START;
 253   1      }
 254          
 255          //-----------------------------------------------------------------//
 256          //º¯ÊýÃû³Æ£º void CTK_ISR() interrupt 12
 257          //º¯Êý¹¦ÄÜ£º CTKÖÐ¶Ï·þÎñº¯Êý
 258          //ÊäÈë²ÎÊý£º ÎÞ
 259          //Êä³ö²ÎÊý£º ÎÞ
 260          //·µ »Ø Öµ£º ÎÞ
 261          //-----------------------------------------------------------------// 
 262          void CTK_ISR() interrupt 12
 263          {
 264   1            static uchar xdata addr_bak = 0;
 265   1            PUSH_REG_ADDR_SFR();
 266   1            CTK_INT_FLAG_CLR;//Çå³ýCTKÖÐ¶Ï±êÖ¾Î»
 267   1      
 268   1            CTK_STOP; 
 269   1            ctk_soft_reset_count = 0;
 270   1            
 271   1            if(parallel_mode == 0)
 272   1            {
 273   2              
 274   2                #if (CS_SW == 1)
                        if(adjust_done_flag == 0)
                        #endif    
 277   2                {         
 278   3                  EA = 0;
 279   3                  raw_data[sns_next] = ((unsigned int)CSD_RAWDATAH << 8) | (unsigned int)CSD_RAWDATAL;//»ñÈ¡CTKÊý¾Ý
 280   3                  EA = 1; 
 281   3                }
 282   2                
 283   2                
 284   2                if(adjust_done_flag == 0)
 285   2                {
 286   3      
 287   3                  #if IDLE_MODE
                            parallel_init_flag = 0;
                          #endif
 290   3                  
 291   3                  CTK_BF7615BMXX_XXXX_Adjust_Int();
 292   3                  
 293   3                }
 294   2                else
 295   2                {
 296   3                    if(parallel_init_flag == 1)
 297   3                    {
 298   4      
 299   4                      #if (CS_SW == 1)  
                                cs_noise = Data_Deal(8,0,SNS_NUM); 
                                Set_Next_SNS();
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 6   

                              #else
 303   4                      
 304   4                      sns_next++;
 305   4                      while(sensor_open[sns_next] == 0xFF)
 306   4                      {
 307   5                          CTK_STOP; 
 308   5                          sns_next++;
 309   5                          if(sns_next >= SNS_NUM)
 310   5                          {
 311   6                              sns_next = 0;
 312   6                              ctk_circle_done = 1;
 313   6                              break;
 314   6                          }
 315   5                      }
 316   4                      if(sns_next >= SNS_NUM)
 317   4                      {
 318   5                          sns_next = 0;
 319   5                          ctk_circle_done = 1;
 320   5                      }
 321   4                  
 322   4                      Set_Next_SNS();
 323   4                      #endif
 324   4                    
 325   4                    }
 326   3                    #if IDLE_MODE
                            else
                            {
                                  EA = 0;
                                  raw_data_parallel[0] = ((unsigned int)CSD_RAWDATAH << 8) | (unsigned int)CSD_RAWDATAL;//»ñÈ¡CTKÊ
             -ý¾Ý
                                  EA = 1;
                                  
                                  CTK_BF7615BMXX_XXXX_Para_Adjust_Int();
                            }
                            #endif
 336   3                }
 337   2            }
 338   1            #if IDLE_MODE
                    else
                    {
                        EA = 0;
                        raw_data_parallel[0] = ((unsigned int)CSD_RAWDATAH << 8) | (unsigned int)CSD_RAWDATAL;//»ñÈ¡CTKÊý¾Ý
                        EA = 1;
                      
                        ctk_para_done = 1;
                        Set_Para_SNS();
                        
                    }
                    #endif
 350   1            POP_REG_ADDR_SFR();
 351   1      }
 352          
 353          
 354          //-----------------------------------------------------------------//
 355          //º¯ÊýÃû³Æ£º void Base_Line_Init()
 356          //º¯Êý¹¦ÄÜ£º »ùÏß³õÊ¼»¯
 357          //ÊäÈë²ÎÊý£º ÎÞ
 358          //Êä³ö²ÎÊý£º ÎÞ
 359          //·µ »Ø Öµ£º ÎÞ
 360          //-----------------------------------------------------------------//
 361          
 362          void Base_Line_Init()
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 7   

 363          {   
 364   1          unsigned char xdata i;
 365   1          for (i = 0; i < SNS_NUM; i++) 
 366   1          {
 367   2            #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
 368   2                EA = 0;
 369   2                base_line[i] = raw_data[i];
 370   2                EA = 1;
 371   2            #endif
 372   2          } 
 373   1      }
 374          
 375          //-----------------------------------------------------------------//
 376          //º¯ÊýÃû³Æ£º void CTK_BF7615BMXX_XXXX_Get_KEYS_Touch(unsigned char sns)
 377          //º¯Êý¹¦ÄÜ£º »ñÈ¡°´¼ü±êÖ¾£¬³¤°´³¬Ê±Çå³ý
 378          //ÊäÈë²ÎÊý£º unsigned char sns:¶ÔÓ¦µÄSensorÍ¨µÀ
 379          //Êä³ö²ÎÊý£º ÎÞ
 380          //·µ »Ø Öµ£º ÎÞ
 381          //-----------------------------------------------------------------//
 382          void CTK_BF7615BMXX_XXXX_Get_KEYS_Touch(unsigned char sns)
 383          {
 384   1      
 385   1        if(sensor_open[sns] < 32)
 386   1        {
 387   2          if(((sensor_flag_l & (((unsigned long)0x01) << sensor_open[sns]))==0))
 388   2          {
 389   3            touch_left_count[sns]++;
 390   3            
 391   3            if(touch_left_count[sns] >= TK_LEFT_COUNT)
 392   3            {
 393   4                touch_left_count[sns] = 0;
 394   4                keys_flag_l &= ~(((unsigned long)0x01) << sensor_open[sns]);
 395   4            }
 396   3          }
 397   2          else
 398   2          {
 399   3            touch_left_count[sns] = 0;
 400   3          }
 401   2        }
 402   1        else
 403   1        {
 404   2          if(((sensor_flag_h & (((unsigned long)0x01) << (sensor_open[sns]-32)))==0))
 405   2          {
 406   3            touch_left_count[sns]++;
 407   3            
 408   3            if(touch_left_count[sns] >= TK_LEFT_COUNT)
 409   3            {
 410   4                touch_left_count[sns] = 0;
 411   4                keys_flag_h &= ~(((unsigned long)0x01) << (sensor_open[sns]-32));
 412   4            }
 413   3          }
 414   2          else
 415   2          {
 416   3            touch_left_count[sns] = 0;
 417   3          }
 418   2        }
 419   1        
 420   1        
 421   1        if((sensor_flag_l != 0)||(sensor_flag_h != 0))
 422   1        {
 423   2          #if(LONG_KEY_COUNT != 0)
 424   2            if(long_key_clear_count >= LONG_KEY_COUNT)
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 8   

 425   2            {
 426   3              Base_Line_Init();
 427   3              long_key_clear_count = 0;
 428   3              keys_flag_l = sensor_flag_l = 0;
 429   3              keys_flag_h = sensor_flag_h = 0;
 430   3            }
 431   2            
 432   2          #endif  
 433   2        }
 434   1        else
 435   1        {
 436   2          long_key_clear_count = 0;
 437   2        }
 438   1            
 439   1      
 440   1      } 
 441          
 442          //-----------------------------------------------------------------//
 443          //º¯ÊýÃû³Æ£º void CTK_SNS_Renovate(unsigned char addr,unsigned int fth)
 444          //º¯Êý¹¦ÄÜ£º SNS»ùÏß¸üÐÂ
 445          //ÊäÈë²ÎÊý£º unsigned char addr£ºSNSÍ¨µÀ;unsigned int fth:ÊÖÖ¸ãÐÖµ
 446          //Êä³ö²ÎÊý£º ÎÞ
 447          //·µ »Ø Öµ£º ÎÞ
 448          //-----------------------------------------------------------------//
 449          void CTK_SNS_Renovate(unsigned char addr,unsigned int fth)
 450          {
 451   1        uchar i = 0;
 452   1        long differ = 0;
 453   1        long differ_mode1 = 0;
 454   1        long fth_tem = 0;
 455   1        fth_tem = fth;
 456   1        differ = (long)base_line[addr] - (long)raw_data[addr];
 457   1        
 458   1        #if (CS_SW == 1)
                  if(cs_noise >= CS_NOISE)
                  {
                    fth_tem = (CS_FTH_RATE*fth_tem)/10;
                  }
                  if(sensor_open[addr] < 32)
                  {
                    if((keys_flag_l & ((ulong)0x01 << sensor_open[addr])))
                    {
                      fth_tem = (FTHD_HY_RATE*fth_tem)/10;
                    }
                  }
                  else
                  {
                    if((keys_flag_h & ((ulong)0x01 << (sensor_open[addr]-32))))
                    {
                      fth_tem = (FTHD_HY_RATE*fth_tem)/10;
                    }
                  }
              
                #endif
 479   1        
 480   1        
 481   1        
 482   1        #if (RENOVATE_MODE == 1)
                  //Ä£Ê½1
                  
                    if(water_flow_flag == 1)
                    {
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 9   

                      if(sensor_open[addr] < 32)
                      {
                        if((mode_flag_l & (((unsigned long)0x01) << sensor_open[addr])))
                        {
                            fth_tem = (fth_tem*RENOVATE_MODE1_FTH_RATE/10);//Ä£Ê½1ÊÖÖ¸ãÐÖµ  
                        }
                      }
                      else
                      {
                        if((mode_flag_h & (((unsigned long)0x01) << (sensor_open[addr]-32))))
                        {
                            fth_tem = (fth_tem*RENOVATE_MODE1_FTH_RATE/10);//Ä£Ê½1ÊÖÖ¸ãÐÖµ  
                        }
                      }
                    }
                #endif
 503   1          if(sensor_open[addr] < 32)
 504   1          {
 505   2            if((keys_flag_l & ((ulong)0x01 << sensor_open[addr])))
 506   2            {
 507   3              fth_tem = (TK_RATE_HY*fth_tem)/10;
 508   3            }
 509   2          }
 510   1          else
 511   1          {
 512   2            if((keys_flag_h & ((ulong)0x01 << (sensor_open[addr]-32))))
 513   2            {
 514   3              fth_tem = (TK_RATE_HY*fth_tem)/10;
 515   3            }
 516   2          }
 517   1        
 518   1          #if (MULTI_KEY_MAX_COUNT != 0)
                  if(differ >= 0)
                  {
                    if(differ >= (((int)fth)*RENOVATE_NTH_RATE/10))//¶à°´¼ü±êÖ¾ÅÐ¶Ï
                    {
                        if(sensor_open[addr] < 32)
                        {
                          muli_key_flag_l |= ((long)0x01 << sensor_open[addr]); 
                        }
                        else
                        {
                          muli_key_flag_h |= ((long)0x01 << (sensor_open[addr]-32));  
                        }
                    }
                    else
                    {
                        if(sensor_open[addr] < 32)
                        {
                          muli_key_flag_l &= ~((long)0x01 << sensor_open[addr]);  
                        }
                        else
                        {
                          muli_key_flag_h &= ~((long)0x01 << (sensor_open[addr]-32)); 
                        } 
                    }
                  }
                  else
                  {
                      if(sensor_open[addr] < 32)
                      {
                        muli_key_flag_l &= ~((long)0x01 << sensor_open[addr]);  
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 10  

                      }
                      else
                      {
                        muli_key_flag_h &= ~((long)0x01 << (sensor_open[addr]-32)); 
                      }   
                  }
                  #endif
 556   1          
 557   1          #if (RENOVATE_MODE == 1)
                  //Ä£Ê½1
                  differ_mode1 = (long)n_base_line[addr] - (long)base_line[addr];
              
                  if(differ_mode1 >= 0)//Ä£Ê½1differÅÐ¶Ï
                  {
                    if(differ_mode1 >= (((int)fth)*WATER_FLOW_RATE/10))//Ä£Ê½1±êÖ¾ÅÐ¶Ï
                    {
                        if(sensor_open[addr] < 32)
                        {
                          mode_flag_l |= ((long)0x01 << sensor_open[addr]); 
                        }
                        else
                        {
                          mode_flag_h |= ((long)0x01 << (sensor_open[addr]-32));  
                        }
                        n_base_line_reno_count[addr] = 0;
                    }
                    else
                    {
                        n_base_line_reno_count[addr]++;
                        if(n_base_line_reno_count[addr] >= N_BASE_LINE_RENO_MAX_COUNT)
                        {
                            n_base_line[addr] -= differ_mode1/10;
                            n_base_line_reno_count[addr] = 0;
                          
                            if(sensor_open[addr] < 32)
                            {
                              if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
                              {
                                mode_flag_l &= ~((long)0x01 << sensor_open[addr]);
                              }           
                            }
                            else
                            {
                              if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<< (sensor_open[addr]-32)))
                              {
                                mode_flag_h &= ~((long)0x01 << (sensor_open[addr]-32));
                              }
                            }
                        }
                    }
                  }
                  else
                  {
                      if(sensor_open[addr] < 32)
                      {
                        if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
                        {
                      
                          n_base_line[addr] -= differ_mode1/10;
                          
                        }
                      }
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 11  

                      else
                      {
                        if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
                        {
                      
                          n_base_line[addr] -= differ_mode1/10;
                          
                        }
                      }
              
                      if(sensor_open[addr] <32)
                      {
                        mode_flag_l &= ~((long)0x01 << sensor_open[addr]);
                      }
                      else
                      {
                        mode_flag_h &= ~((long)0x01 << (sensor_open[addr]-32));
                      }
                  }
              
                  water_flow_key_count = 0;
                  for(i = 0; i < SNS_NUM;i++)//Ä£Ê½1¶à°´¼üÅÐ¶Ï
                  {
                    if(sensor_open[i] < 32)
                    {
                      if((mode_flag_l & (((unsigned long)0x01) << sensor_open[i])))
                      {
                        water_flow_key_count++;//Ä£Ê½1ÒçË®¼ÆÊý
                      }
                    }
                    else
                    {
                      if((mode_flag_h & (((unsigned long)0x01) << (sensor_open[i]-32))))
                      {
                        water_flow_key_count++;//Ä£Ê½1ÒçË®¼ÆÊý
                      }
                    }
                  }
                
                  if(water_flow_key_count > WATER_FLOW_MAX_COUNT)//Ä£Ê½1ÒçË®ÅÐ¶Ï
                  {
                      
                      water_flow_key_count = 0;
                      water_flow_key_reset_cnt++;
                      if(water_flow_key_reset_cnt >= WATER_FLOW_RST_COUNT)
                      {
                        water_flow_key_reset_cnt = 0;   
                        if(water_flow_flag == 0)
                        {
                          Base_Line_Init();
                          water_flow_flag = 1;
                          
                        }
                      }
                  }
                  else
                  {
                    if(water_flow_flag == 1)//Ä£Ê½1ÒçË®±êÖ¾ÅÐ¶Ï¼ÆÊýÇå³ý
                    {
                        water_flow_left_count++;
                        if(water_flow_left_count >= WATER_FLOW_LEFT_MAX_COUNT)
                        {
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 12  

                          water_flow_flag = 0;
                          water_flow_left_count = 0;
                        }
                    }
                    else
                    {
                      water_flow_left_count = 0;
                    }
                  }
                #endif
 683   1      
 684   1        if(differ >= 0)//differ´óÓÚ0Çé¿ö
 685   1        {
 686   2          #if (RENOVATE_MODE == 1)
                    //Ä£Ê½1
                    if(sensor_open[addr] < 32)
                    {
                      if((mode_flag_l & (((unsigned long)0x01) << sensor_open[addr])))
                      {
                          fth_tem = (fth_tem*RENOVATE_MODE1_FTH_RATE/10);//Ä£Ê½1ÊÖÖ¸ãÐÖµ  
                      }
                    }
                    else
                    {
                      if((mode_flag_h & (((unsigned long)0x01) << (sensor_open[addr]-32))))
                      {
                          fth_tem = (fth_tem*RENOVATE_MODE1_FTH_RATE/10);//Ä£Ê½1ÊÖÖ¸ãÐÖµ  
                      }
                    }
                  #endif
 703   2            
 704   2          if(differ >= (fth_tem*RENOVATE_FTH_RATE/10))
 705   2          {
 706   3              //²»×÷»ùÏß¸üÐÂ
 707   3          }
 708   2          else if(differ >= (((int)fth)*RENOVATE_NTH_RATE/10))//>=p_noise»ùÏß¸üÐÂ
 709   2          {
 710   3              #if(RENOVATE_MODE == 0)//Ä£Ê½0»ùÏß¸üÐÂ
 711   3              
 712   3                  over_p_noise_count[addr]++;
 713   3                  
 714   3                  under_p_noise_count[addr] = 0;
 715   3                  over_n_noise_count[addr] = 0;
 716   3                  under_n_noise_count[addr] = 0;
 717   3                  under_2n_noise_count[addr] = 0;
 718   3                  if(over_p_noise_count[addr] >= OVER_P_NOISE_MAX_COUNT)
 719   3                  {
 720   4                    over_p_noise_count[addr] = 0;
 721   4                    
 722   4                    #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
 723   4                    if(sensor_open[addr] < 32)
 724   4                    {
 725   5                      if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
 726   5                      {
 727   6                        if(base_line[addr] >= (((int)fth)*RENOVATE_NTH_RATE/10/5))
 728   6                        {
 729   7                          base_line[addr] -= differ/5;
 730   7                        }
 731   6                      }
 732   5                    }
 733   4                    else
 734   4                    {
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 13  

 735   5                      if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
 736   5                      {
 737   6                        if(base_line[addr] >= (((int)fth)*RENOVATE_NTH_RATE/10/5))
 738   6                        {
 739   7                
 740   7                          base_line[addr] -= differ/5;
 741   7                          
 742   7                        }
 743   6                      }
 744   5                    }
 745   4                    #endif
 746   4      
 747   4                  }
 748   3              
 749   3              #endif
 750   3                  
 751   3              #if(RENOVATE_MODE == 1)//Ä£Ê½1»ùÏß¸üÐÂ
                      
                          over_p_noise_count[addr]++;
                          
                          under_p_noise_count[addr] = 0;
                          over_n_noise_count[addr] = 0;
                          under_n_noise_count[addr] = 0;
                          under_2n_noise_count[addr] = 0;
                          if(over_p_noise_count[addr] >= WATER_OVER_P_NOISE_MAX_COUNT)
                          {
                            over_p_noise_count[addr] = 0;
                            #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
                            if(sensor_open[addr] < 32)
                            {
                              if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
                              {
                                if(base_line[addr] >= (((int)fth)*RENOVATE_NTH_RATE/10/5))
                                {
                        
                                  base_line[addr] -= differ/5;
                                  
                                }
                              }
                            }
                            else
                            {
                              if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
                              {
                                if(base_line[addr] >= (((int)fth)*RENOVATE_NTH_RATE/10/5))
                                {
                        
                                  base_line[addr] -= differ/5;
                                  
                                }
                              }
                            }
                            #endif
                          }
                      
                      #endif
 791   3                  
 792   3              
 793   3          }
 794   2          else//differ<=p_noise»ùÏß¸üÐÂ
 795   2          {
 796   3              #if(RENOVATE_MODE == 0)//Ä£Ê½0»ùÏß¸üÐÂ
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 14  

 797   3              
 798   3                  over_p_noise_count[addr] = 0;
 799   3                  under_p_noise_count[addr]++;
 800   3                  over_n_noise_count[addr] = 0;
 801   3                  under_n_noise_count[addr] = 0;
 802   3                  under_2n_noise_count[addr] = 0;
 803   3                  if(under_p_noise_count[addr] >= UNDER_P_NOISE_MAX_COUNT)
 804   3                  {
 805   4                    under_p_noise_count[addr] = 0;
 806   4                    
 807   4                    #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
 808   4                    if(sensor_open[addr] < 32)
 809   4                    {
 810   5                      if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
 811   5                      {
 812   6                        base_line[addr] = raw_data[addr];
 813   6                      }
 814   5                    }
 815   4                    else
 816   4                    {
 817   5                      if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
 818   5                      {
 819   6                        base_line[addr] = raw_data[addr];
 820   6                      }
 821   5                    }
 822   4                    #endif
 823   4                    
 824   4                  }
 825   3              
 826   3              #endif
 827   3              #if (RENOVATE_MODE == 1)
                      //Ä£Ê½1»ùÏß¸üÐÂ
                      
                          over_p_noise_count[addr] = 0;
                          under_p_noise_count[addr]++;
                          over_n_noise_count[addr] = 0;
                          under_n_noise_count[addr] = 0;
                          under_2n_noise_count[addr] = 0;
                          if(under_p_noise_count[addr] >= UNDER_P_NOISE_MAX_COUNT)
                          {
                            under_p_noise_count[addr] = 0;
                            if(sensor_open[addr] < 32)
                            {
                              if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
                              {
                                base_line[addr] = raw_data[addr];
                              }
                            }
                            else
                            {
                              if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
                              {
                                base_line[addr] = raw_data[addr];
              
                              }
                            }
                          }
                      
                      #endif
 856   3          }
 857   2        }
 858   1        else//differ<0µÄÇé¿ö
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 15  

 859   1        {
 860   2          
 861   2          if(differ >= (-(((int)fth)*RENOVATE_NTH_RATE/10)))//>= n_poiseÇé¿ö
 862   2          {
 863   3              #if(RENOVATE_MODE == 0)//Ä£Ê½0»ùÏß¸üÐÂ
 864   3                over_p_noise_count[addr] = 0;
 865   3                under_p_noise_count[addr] = 0;
 866   3                over_n_noise_count[addr]++;
 867   3                under_n_noise_count[addr] = 0;
 868   3                under_2n_noise_count[addr] = 0;
 869   3                if(over_n_noise_count[addr] >= OVER_N_NOISE_MAX_COUNT)
 870   3                {
 871   4                  over_n_noise_count[addr] = 0;
 872   4                  
 873   4                  #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
 874   4                  if(sensor_open[addr] < 32)
 875   4                  {
 876   5                    if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
 877   5                    {
 878   6                      base_line[addr] = raw_data[addr];
 879   6                    }
 880   5                  }
 881   4                  else
 882   4                  {
 883   5                    if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
 884   5                    {
 885   6                      base_line[addr] = raw_data[addr];
 886   6                    }
 887   5                  }
 888   4                  #endif
 889   4            
 890   4                }
 891   3            
 892   3              #endif
 893   3                
 894   3              #if (RENOVATE_MODE == 1)
                      //Ä£Ê½1»ùÏß¸üÐÂ
                      
                        over_p_noise_count[addr] = 0;
                        under_p_noise_count[addr] = 0;
                        over_n_noise_count[addr]++;
                        under_n_noise_count[addr] = 0;
                        if(over_n_noise_count[addr] >= OVER_N_NOISE_MAX_COUNT)
                        {
                          over_n_noise_count[addr] = 0;
                          if(sensor_open[addr] < 32)
                          {
                            if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
                            {
                              base_line[addr] = raw_data[addr];
                            }
                          }
                          else
                          {
                            if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
                            {
                              base_line[addr] = raw_data[addr];
              
                            }
                          }
                        }
                      
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 16  

                      #endif
 922   3          }
 923   2          else if((differ >= -(UNDER_N*((int)fth)*RENOVATE_FTH_RATE/10)))
 924   2          {
 925   3                #if(RENOVATE_MODE == 0)//Ä£Ê½0»ùÏß¸üÐÂ
 926   3                  over_p_noise_count[addr] = 0;
 927   3                  under_p_noise_count[addr] = 0;
 928   3                  over_n_noise_count[addr] = 0;
 929   3                  under_n_noise_count[addr]++;
 930   3                  under_2n_noise_count[addr] = 0;
 931   3              
 932   3                  if(under_n_noise_count[addr] >= UNDER_N_NOISE_MAX_COUNT)
 933   3                  {
 934   4                    under_n_noise_count[addr] = 0;
 935   4                    
 936   4                    
 937   4                    #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
 938   4                    if(sensor_open[addr] < 32)
 939   4                    {
 940   5                      if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
 941   5                      {
 942   6                        base_line[addr] -= differ/2;            
 943   6                      }
 944   5                    }
 945   4                    else
 946   4                    {
 947   5                      if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
 948   5                      {
 949   6                        base_line[addr] -= differ/2;            
 950   6                      }
 951   5                    }
 952   4                    #endif          
 953   4                  
 954   4                  }
 955   3              #endif
 956   3                
 957   3              #if(RENOVATE_MODE == 1)//Ä£Ê½1»ùÏß¸üÐÂ
                          over_p_noise_count[addr] = 0;
                          under_p_noise_count[addr] = 0;
                          over_n_noise_count[addr] = 0;
                          under_n_noise_count[addr]++;
                          under_2n_noise_count[addr] = 0;
                      
                          if(under_n_noise_count[addr] >= UNDER_N_NOISE_MAX_COUNT)
                          {
                            under_n_noise_count[addr] = 0;
                            #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
                            if(sensor_open[addr] < 32)
                            {
                              if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
                              {
                                  base_line[addr] -= differ/2;        
                              }
                            }
                            else
                            {
                              if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
                              {
                                  base_line[addr] -= differ/2;        
                              }
                            }
                            #endif          
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 17  

                            
                          }
                      #endif
 986   3            }
 987   2            else
 988   2            {
 989   3                #if(RENOVATE_MODE == 0)//Ä£Ê½0»ùÏß¸üÐÂ
 990   3                over_p_noise_count[addr] = 0;
 991   3                under_p_noise_count[addr] = 0;
 992   3                over_n_noise_count[addr] = 0;
 993   3                under_n_noise_count[addr] = 0;
 994   3                under_2n_noise_count[addr]++;     
 995   3                if(under_2n_noise_count[addr] >= UNDER_2N_NOISE_MAX_COUNT)
 996   3                {
 997   4                  under_2n_noise_count[addr] = 0;
 998   4                  
 999   4                  #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
1000   4                    if(sensor_open[addr] < 32)
1001   4                    {
1002   5                      if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
1003   5                      {
1004   6                        base_line[addr] -= differ/5;              
1005   6                      }
1006   5                    }
1007   4                    else
1008   4                    {
1009   5                      if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
1010   5                      {
1011   6                        base_line[addr] -= differ/5;              
1012   6                      }
1013   5                    }
1014   4                  #endif
1015   4                  
1016   4                } 
1017   3                #endif
1018   3                
1019   3                #if(RENOVATE_MODE == 1)//Ä£Ê½1»ùÏß¸üÐÂ
                        over_p_noise_count[addr] = 0;
                        under_p_noise_count[addr] = 0;
                        over_n_noise_count[addr] = 0;
                        under_n_noise_count[addr] = 0;
                        under_2n_noise_count[addr]++;     
                        if(under_2n_noise_count[addr] >= UNDER_2N_NOISE_MAX_COUNT)
                        {
                          under_2n_noise_count[addr] = 0;
                          
                          #if (KEYS_RENOVATE_FLAG_L || KEYS_RENOVATE_FLAG_H)
                            if(sensor_open[addr] < 32)
                            {
                              if(KEYS_RENOVATE_FLAG_L &(((unsigned long)0x01)<<sensor_open[addr]))
                              {
                                base_line[addr] -= differ/5;            
                              }
                            }
                            else
                            {
                              if(KEYS_RENOVATE_FLAG_H &(((unsigned long)0x01)<<(sensor_open[addr]-32)))
                              {
                                base_line[addr] -= differ/5;            
                              }
                            }
                          #endif
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 18  

                          
                        } 
                        #endif
1048   3            }
1049   2        }
1050   1        
1051   1        if(differ >= 0)
1052   1        {
1053   2          #if(TK_EOT != 0)
                  
                  if(differ < (fth_tem*TK_EOT))//ÔÚÏû¶¥ÖµÒÔÏÂ
                  {
                    
                    if(differ < (fth_tem*RENOVATE_FTH_RATE/10))//ÎÞ°´¼ü
                    {
                      if(sensor_open[addr] < 32)
                      {
                        sensor_flag_l &= ~(((unsigned long)0x01) << sensor_open[addr]);
                      }
                      else
                      {
                        sensor_flag_h &= ~(((unsigned long)0x01) << (sensor_open[addr]-32));
                      }
                      touch_confirm_count[addr] = 0;
                    }
                    else//ÓÐ°´¼ü
                    {
                        touch_left_count[addr] = 0;
                        touch_confirm_count[addr]++;
                    }
                  }
                  else//ÎÞ°´¼ü
                  {
              
                      if(sensor_open[addr] < 32)
                      {
                        sensor_flag_l &= ~(((unsigned long)0x01) << sensor_open[addr]);
                      }
                      else
                      {
                        sensor_flag_h &= ~(((unsigned long)0x01) << (sensor_open[addr]-32));
                      }
              
                      touch_confirm_count[addr] = 0;
                  }
                  
                  #else//ÎÞÏû¶¥ÅÐ¶Ï
1092   2          
1093   2          if(differ < (fth_tem*RENOVATE_FTH_RATE/10))
1094   2          {
1095   3            
1096   3            if(sensor_open[addr] < 32)
1097   3            {
1098   4              sensor_flag_l &= ~(((unsigned long)0x01) << sensor_open[addr]);
1099   4            }
1100   3            else
1101   3            {
1102   4              sensor_flag_h &= ~(((unsigned long)0x01) << (sensor_open[addr]-32));
1103   4            }
1104   3            touch_confirm_count[addr] = 0;  
1105   3          }
1106   2          else
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 19  

1107   2          {
1108   3              touch_confirm_count[addr]++;
1109   3          }
1110   2          
1111   2          #endif
1112   2        }//Differ<0
1113   1        else
1114   1        {
1115   2          
1116   2            if(sensor_open[addr] < 32)
1117   2            {
1118   3              sensor_flag_l &= ~(((unsigned long)0x01) << sensor_open[addr]);
1119   3            }
1120   2            else
1121   2            {
1122   3              sensor_flag_h &= ~(((unsigned long)0x01) << (sensor_open[addr]-32));
1123   3            }
1124   2            
1125   2            touch_confirm_count[addr] = 0;
1126   2        }
1127   1      
1128   1      
1129   1        if(touch_confirm_count[addr] > TK_COMFIRM_COUNT)
1130   1        {
1131   2          if(sensor_open[addr] < 32)
1132   2          {
1133   3            keys_flag_l |= sensor_flag_l |= (((unsigned long)0x01) << sensor_open[addr]);
1134   3            touch_confirm_count[addr] = 0;
1135   3          }
1136   2          else
1137   2          {
1138   3            keys_flag_h |= sensor_flag_h |= (((unsigned long)0x01) << (sensor_open[addr]-32));
1139   3            touch_confirm_count[addr] = 0;
1140   3          }
1141   2        }
1142   1        else
1143   1        {
1144   2          
1145   2          
1146   2        }
1147   1      }
1148          
1149          
1150          
1151          //-----------------------------------------------------------------//
1152          //º¯ÊýÃû³Æ£º void CTK_BF7615BMXX_XXXX_Set_Para(unsigned int i_rank)
1153          //º¯Êý¹¦ÄÜ£º ÅäÖÃËùÓÐÍ¨µÀ²ÎÊý
1154          //ÊäÈë²ÎÊý£º 
1155          //unsigned int i_rank:µçÁ÷Ô´¼¶Êý;
1156          //Êä³ö²ÎÊý£º ÎÞ
1157          //·µ »Ø Öµ£º ÎÞ
1158          //-----------------------------------------------------------------//        
1159          void CTK_BF7615BMXX_XXXX_Set_Para(unsigned int i_rank)
1160          {
1161   1          CTK_PULL_I_SET(i_rank);     //ÉèÖÃµçÁ÷Ô´¼¶Êý
1162   1      }
1163          
1164          //-----------------------------------------------------------------//
1165          //º¯ÊýÃû³Æ£º void CTK_BF7615BMXX_XXXX_Adjust_Int(void)
1166          //º¯Êý¹¦ÄÜ£ºÍ¨µÀµçÁ÷Ô´×ÔÊÊÓ¦
1167          //ÊäÈë²ÎÊý£º ÎÞ
1168          //Êä³ö²ÎÊý£º ÎÞ
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 20  

1169          //·µ »Ø Öµ£º ÎÞ
1170          //-----------------------------------------------------------------//        
1171          
1172          void CTK_BF7615BMXX_XXXX_Adjust_Int(void)
1173          {
1174   1        if(adjust_count < 3)
1175   1        {
1176   2          while(1)
1177   2          {
1178   3            WDT_CTRL = 7;
1179   3            
1180   3            if((raw_data[sns_next] >= ADJUST_LINE))
1181   3            {
1182   4              if(pull_i_value[sns_next] < (511 - ADJUST_STE))
1183   4              {
1184   5                pull_i_value[sns_next] += (1 + ADJUST_STE);
1185   5                CTK_PULL_I_SET(pull_i_value[sns_next]);//ÉèÖÃ¼¶Êý
1186   5      
1187   5                Set_Next_SNS();
1188   5                return;
1189   5              } 
1190   4              else
1191   4              {
1192   5                
1193   5                sns_next++;
1194   5                if(sns_next >= SNS_NUM)
1195   5                {
1196   6                    sns_next = 0;
1197   6                    adjust_count = 0;
1198   6                    adjust_done_flag = 1;
1199   6                }
1200   5                
1201   5                Set_Next_SNS();
1202   5                return;
1203   5              }
1204   4            }
1205   3            else
1206   3            { 
1207   4                n_base_line[sns_next] = base_line[sns_next] = raw_data[sns_next];
1208   4                sns_next++;
1209   4                if(sns_next >= SNS_NUM)
1210   4                {
1211   5                    if(adjust_count < 3)
1212   5                    {
1213   6                      adjust_count++;
1214   6                    }
1215   5      
1216   5                    sns_next = 0;
1217   5                    if(pull_i_value[sns_next] > (0))
1218   5                    {
1219   6                      pull_i_value[sns_next] -= (1);
1220   6                      CTK_PULL_I_SET(pull_i_value[sns_next]);//ÉèÖÃ¼¶Êý
1221   6                      Set_Next_SNS();
1222   6                      return;
1223   6                    }
1224   5                  
1225   5                    Set_Next_SNS();
1226   5                    break;
1227   5                }
1228   4      
1229   4                if(pull_i_value[sns_next] > (0))
1230   4                {
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 21  

1231   5                  pull_i_value[sns_next] -= (1);
1232   5                  CTK_PULL_I_SET(pull_i_value[sns_next]);//ÉèÖÃ¼¶Êý
1233   5                  Set_Next_SNS();
1234   5                  return;
1235   5                }
1236   4                else
1237   4                {
1238   5                    Set_Next_SNS();
1239   5                    return;
1240   5                } 
1241   4            }
1242   3          }
1243   2        }
1244   1        
1245   1        if(adjust_count >= 3)
1246   1        {
1247   2          while(1)
1248   2          {
1249   3            WDT_CTRL = 7;
1250   3            
1251   3            if((raw_data[sns_next] <= ADJUST_LINE))
1252   3            {
1253   4              if(pull_i_value[sns_next] > (0))
1254   4              {
1255   5                pull_i_value[sns_next] -= (1);
1256   5                CTK_PULL_I_SET(pull_i_value[sns_next]);//ÉèÖÃ¼¶Êý
1257   5      
1258   5                Set_Next_SNS();
1259   5                return;
1260   5              } 
1261   4              else
1262   4              {
1263   5                sns_next++;
1264   5                if(sns_next >= SNS_NUM)
1265   5                {
1266   6                    sns_next = 0;
1267   6                    adjust_count = 0;
1268   6                    adjust_done_flag = 1;
1269   6                }
1270   5                Set_Next_SNS();
1271   5                return;
1272   5              }
1273   4            }
1274   3            else
1275   3            { 
1276   4                n_base_line[sns_next] = base_line[sns_next] = raw_data[sns_next];
1277   4                sns_next++;
1278   4                if(sns_next >= SNS_NUM)
1279   4                {
1280   5                    sns_next = 0;
1281   5      
1282   5                    
1283   5                    if(adjust_count < 6)
1284   5                    {
1285   6                      adjust_count++;
1286   6                    }
1287   5                    if(adjust_count >= 6)
1288   5                    {
1289   6                      adjust_count = 0;
1290   6                      adjust_done_flag = 1;
1291   6                    }
1292   5                    Set_Next_SNS();
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK                                               04/11/2024 12:54:17 PAGE 22  

1293   5                    break;
1294   5                }
1295   4      
1296   4                if(pull_i_value[sns_next] < (511 - ADJUST_STE))
1297   4                {
1298   5                  pull_i_value[sns_next] += (1 + ADJUST_STE);
1299   5                  CTK_PULL_I_SET(pull_i_value[sns_next]);//ÉèÖÃ¼¶Êý
1300   5                  Set_Next_SNS();
1301   5                  return;
1302   5                }
1303   4                else
1304   4                {
1305   5                    Set_Next_SNS();
1306   5                    return;
1307   5                } 
1308   4            }
1309   3          }
1310   2        }
1311   1      }
1312          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3937    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    140       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1      18
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
