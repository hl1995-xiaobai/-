C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK_TRACE                                         04/10/2024 19:57:35 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE BF7615BMXX_XXXX_CTK_TRACE
OBJECT MODULE PLACED IN .\Output\BF7615BMXX_XXXX_CTK_Trace.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE BF7615BMXX_XXXX_Library\BF7615BMXX_XXXX_CTK_Lib\BF7615BMXX_XXXX_CTK_Trac
                    -e.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Application_Library;.\BF7615BMXX_XXXX_Library;.\Code;.\Project) DEBUG PRINT(.
                    -\List\BF7615BMXX_XXXX_CTK_Trace.lst) TABS(2) OBJECT(.\Output\BF7615BMXX_XXXX_CTK_Trace.obj)

line level    source

   1          #include ".\BF7615BMXX_XXXX_Library\Config.h"
   2          
   3          #if (TRACEMODE == TRUE)
              void TraceMode_Master_Read_Data(unsigned int xdata *p_rawData,unsigned int xdata *p_baseline,unsigned long
             -  t_keysFlagSN,unsigned long  t_keysFlagSN_H);   
              unsigned char xdata ReadCnt = 0;
              unsigned char xdata ReceData = 0;
              unsigned char xdata DataNum = 0;
              bit OddCheck = 0,NeedCheckOdd = 0;
              unsigned int xdata raw = 0;
              unsigned int xdata bas = 0;
              
              #if (TRACEMODE==1)
                #pragma message "±àÒë,TRACEMODE¹¦ÄÜ"
                unsigned long xdata keys_flag_l_Tracemode = 0;  
                unsigned long xdata keys_flag_h_Tracemode = 0;  
                //-----------------------------------------------------------------//
                //º¯ÊýÃû³Æ£º void Trace_Mode_IIC_ISR_PA() interrupt 10 
                //º¯Êý¹¦ÄÜ£º PA¿ÚIICÖÐ¶Ï×Óº¯Êý
                //ÊäÈë²ÎÊý£º ÎÞ
                //Êä³ö²ÎÊý£º ÎÞ
                //·µ »Ø Öµ£º ÎÞ
                //-----------------------------------------------------------------//
              
                void Trace_Mode_IIC_ISR_PA() interrupt 10
                {
                    uchar tmp;
                    static uchar xdata addr_bak = 0;
                    PUSH_REG_ADDR_SFR();
                    EA = 0;
                    IRCON1 &= ~0x08;
                    if ((IICSTAT & 0x02))//Ð´³åÍ»±êÖ¾Î»
                    { 
                        IICSTAT &= ~0x02;
                    }
                    if ((IICSTAT & 0x01))//¶Á³åÍ»±êÖ¾Î»  
                    {
                        
                        IICSTAT &= ~0x01;
                        tmp = IICBUF;
                    }
                    if ((IICSTAT & 0x10) == 0)//ÊÇµØÖ·
                    {  
                    
                        if((IICSTAT & 0x20))//Ö÷»ú¶Á 
                        {
                            
                            ReadCnt = 0;
                            OddCheck = 0;
                            DataNum = 0;
                            
                            TraceMode_Master_Read_Data(&raw_data[0],&base_line[0],keys_flag_l_Tracemode,keys_flag_h_Tracemode);
              
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK_TRACE                                         04/10/2024 19:57:35 PAGE 2   

                            IICCON |= 0x04; 
                        }
                        else //Ö÷»úÐ´
                        {
                            tmp = IICBUF;
                        }   
                      }
                      else 
                      {
                        if ((IICSTAT & 0x20))//Ö÷»ú¶Á 
                        {
                                   
                            TraceMode_Master_Read_Data(&raw_data[0],&base_line[0],keys_flag_l_Tracemode,keys_flag_h_Tracemode);
                            IICCON |= 0x04;   
                        }
                        else//Ö÷»úÐ´  
                        {   
                      
                          if ((IICSTAT & 0x08)) 
                          { 
                            TraceMode_Master_Write_Data();
                          }
                        }
                        
                    }
                    IICCON |= 0x04;
                    POP_REG_ADDR_SFR();
                    EA = 1;
                }
              
                #endif
              
              //-----------------------------------------------------------------//
              //º¯ÊýÃû³Æ£º void BF7615BMXX_XXXX_Trace_Mode_Init(unsigned char IICSlaveAddr,unsigned char iic_port)
              //º¯Êý¹¦ÄÜ£º BF7615BMXX_XXXX_Trace_Mode_Init³õÊ¼»¯
              //ÊäÈë²ÎÊý£º unsigned char IICSlaveAddr:IIC´Ó»úµØÖ·;,unsigned char iic_port://IIC¹¦ÄÜÓ³ÉäÑ¡Ôñ0-ÎªÑ¡ÔñPC4/5
             -Îª´®¿Ú£¬1Ñ¡ÔñPE4/5Îª´®¿Ú
              //Êä³ö²ÎÊý£º ÎÞ
              //·µ »Ø Öµ£º ÎÞ
              //-----------------------------------------------------------------//
              
              void BF7615BMXX_XXXX_Trace_Mode_Init(unsigned char IICSlaveAddr,unsigned char iic_port)
              {
                
                  EA = 0;   //¹Ø×ÜÖÐ¶Ï
                  IPL1 |= 0x08;     //ÉèÖÃIICÖÐ¶ÏÓÅÏÈ¼¶
                  IRCON1 &= ~0x08;  // Çå³ýIICÖÐ¶Ï±êÖ¾Î»
                
                  REG_ADDR = 0x50;REG_DATA = 0x03;//bit1:IICÄ£ÄâÂË²¨Ñ¡Ôñ£º1ÎªÑ¡ÔñÄ£ÄâÂË²¨£¬0Îª²»Ñ¡ÔñÄ£ÄâÂË²¨;bit0:IICÄ£ÄâÂ
             -Ë²¨Ñ¡Ôñ£º1ÎªÑ¡ÔñÊý×ÖÂË²¨£¬0Îª²»Ñ¡ÔñÊý×ÖÂË²¨(SleepÄ£Ê½Ê±£¬IIC²»ÄÜ»½ÐÑMCU)
                
                  if(iic_port == 1)
                  {
              
                      REG_ADDR = 0x1B;REG_DATA |= 0x10;//PE4¿ªÆôÉÏÀ­
                      REG_ADDR = 0x1B;REG_DATA |= 0x20;//PE5¿ªÆôÉÏÀ­
                      
              
                      TRISE |= 0x10;//PE4ÉèÖÃÎªÊäÈë
                      TRISE |= 0x20;//PE5ÉèÖÃÎªÊäÈë
                    
                      {REG_ADDR = 0x34;REG_DATA &= ~(0x10);REG_DATA |= (0x10&(iic_port<<4));}
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK_TRACE                                         04/10/2024 19:57:35 PAGE 3   

                  }
                  else
                  {
                
                      REG_ADDR = 0x19;REG_DATA |= 0x10;//PC4¿ªÆôÉÏÀ­
                      REG_ADDR = 0x19;REG_DATA |= 0x20;//PC5¿ªÆôÉÏÀ­
                      TRISC |= 0x10;//PC4ÉèÖÃÎªÊäÈë
                      TRISC |= 0x20;//PC5ÉèÖÃÎªÊäÈë
                    
                      {REG_ADDR = 0x34;REG_DATA &= ~(0x10);REG_DATA |= (0x10&(iic_port<<4));}
                  }
                  IICADD    = IICSlaveAddr;   //ÉèÖÃIIC´Ó»úµØÖ·£»
                  IICSTAT   = 0x00;           //Çå³ýIIC×´Ì¬¼Ä´æÆ÷£»
                  IICCON    |= 0x01;          //IIC¹¤×÷Ê¹ÄÜ
                  IICCON    |= (0x02);        //IIC×ª»»ËÙÂÊÊÊÓ¦100K
                  IICCON    |= 0x04;          //SLCÊ±ÖÓÕý³£¹¤×÷
                  IICCON    &= (~0x08);       //²»Ê¹ÄÜÐ´À­µÍ,¸ù¾ÝIICÖ÷»ú¶ÁÐ´Ê±ÐòÉèÖÃ
                  IICCON    |= (0x10);        //Ê¹ÄÜ¶ÁÀ­µÍ£¬¸ù¾ÝIICÖ÷»ú¶ÁÐ´Ê±Ðò
                  IEN1      |= 0x08;          //¿ªIICÖÐ¶ÏÊ¹ÄÜ
                  EA = 1;                     //¿ª×ÜÖÐ¶Ï      
              }
              //-----------------------------------------------------------------//
              //º¯ÊýÃû³Æ£º void TraceMode_Master_Read_Data(uint *p_rawData,uint *p_baseline,ulong  t_keysFlagSN,unsigned
             - long  t_keysFlagSN_H)   
              //º¯Êý¹¦ÄÜ£º ½«·¢ËÍµÄÊý¾ÝÐ´ÈëIICBUF
              //ÊäÈë²ÎÊý£º ÎÞ
              //Êä³ö²ÎÊý£º ÎÞ
              //·µ »Ø Öµ£º ÎÞ
              //-----------------------------------------------------------------//
              #pragma disable
              void TraceMode_Master_Read_Data(unsigned int xdata *p_rawData,unsigned int xdata *p_baseline,unsigned long
             -  t_keysFlagSN,unsigned long  t_keysFlagSN_H)     
              {   
                unsigned char data tmp = 0;
              
                if(ReceData == 0xb2)
                {
                  if(ReadCnt == 0)
                  {
                    tmp = 0xae;
                  }
                  else if(ReadCnt == 1)
                  {
                    tmp = CH_MAX;
                    
                  }     
                }
                else if(ReceData == 0xb3)
                {
                  
                  if(ReadCnt < 1)     //·¢ËÍÍ·Âë0XAE
                  {
                    tmp = 0xae; 
                  
                  }
                  else if(ReadCnt < ((CH_MAX<<1) + 1))  //·¢ËÍRAWDATA
                  {
                    NeedCheckOdd = 1;
                    if(ReadCnt % 2) 
                    {
                      
                      raw = *(p_rawData + DataNum);
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK_TRACE                                         04/10/2024 19:57:35 PAGE 4   

                      
                      
                      tmp = (raw >> 8);
                    }
                    else
                    {
                      tmp = raw;
                      DataNum ++; 
                    }
                  }
                  else if(ReadCnt == ((CH_MAX << 1) + 1))  //·¢ËÍBASELINE[0]¸ß8Î»
                  {
                    NeedCheckOdd = 1;
                    DataNum = 0;
                    
                    bas = *(p_baseline + DataNum);
                    
                    tmp = (bas >> 8);
                    
                  }
                  else if(ReadCnt < ((CH_MAX << 2) + 1))    //·¢ËÍBASELINE
                  {
                    
                    NeedCheckOdd = 1;
                    
                    if(ReadCnt % 2) 
                    {
                      bas = *(p_baseline + DataNum);
                      
                      tmp = (bas >> 8);
                    }
                    else
                    {
                      tmp = bas; 
                      DataNum++;  
                    }
                    
                  } 
                  else if(ReadCnt == ((CH_MAX << 2) + 1))   //·¢ËÍÆæÅ¼Ð£ÑéÎ»
                  {
                    tmp = OddCheck;
                    
                  }
                  else if(ReadCnt == ((CH_MAX << 2) + 2))   //·¢ËÍÓÐÐ§Êý¾Ý³¤¶È
                  {           
                    tmp = (CH_MAX << 2);
                  }   
                  
                  else if(ReadCnt == ((CH_MAX << 2) + 3))   //´¥Ãþ±êÖ¾Î»bit31:17
                  {             
                    tmp = (unsigned char )(t_keysFlagSN >> 24);
                  }
                  else if(ReadCnt == ((CH_MAX << 2) + 4))   //´¥Ãþ±êÖ¾Î»bit23:16
                  {            
                    tmp = (unsigned char )(t_keysFlagSN >> 16);   
                  }
                  else if(ReadCnt == ((CH_MAX << 2) + 5))   //´¥Ãþ±êÖ¾Î»bit15:8
                  {           
                    tmp = (unsigned char )(t_keysFlagSN >> 8);
                  }         
                  else if(ReadCnt == ((CH_MAX << 2) + 6))//´¥Ãþ±êÖ¾Î»bit7:0
                  {           
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK_TRACE                                         04/10/2024 19:57:35 PAGE 5   

                    tmp = (unsigned char )t_keysFlagSN; 
                  }
                  
                  else if(ReadCnt == ((CH_MAX << 2) + 7))   //´¥Ãþ±êÖ¾Î»bit63:56
                  {             
                    tmp = (unsigned char )(t_keysFlagSN_H >> 24);
                  }
                  else if(ReadCnt == ((CH_MAX << 2) + 8))   //´¥Ãþ±êÖ¾Î»bit55:48
                  {            
                    tmp = (unsigned char )(t_keysFlagSN_H >> 16);   
                  }
                  else if(ReadCnt == ((CH_MAX << 2) + 9))   //´¥Ãþ±êÖ¾Î»bit47:40
                  {           
                    tmp = (unsigned char )(t_keysFlagSN_H >> 8);
                  }         
                  else if(ReadCnt == ((CH_MAX << 2) + 10))//´¥Ãþ±êÖ¾Î»bit39:32
                  {           
                    tmp = (unsigned char )t_keysFlagSN_H; 
                  }
                
                  else //·¢ËÍ½áÊøÂë0xff¡¢0xff
                  {     
                    ReadCnt = 0;
                    tmp = 0xFF; 
                    
                  }
                }
                
                IICBUF = tmp;//½«IICBUF = tmp;·ÅÔÚ¡°else if(ReceData == 0xb3)¡±ÅÐ¶ÏÍâ
                
                if(NeedCheckOdd)    //µ±Ç°Êý¾ÝÊÇ·ñÐèÒª½øÐÐÆæÅ¼Ð£Ñé
                {
                  NeedCheckOdd = 0;
                  
                  ACC = tmp;
                  if((PSW & 0x01))
                    OddCheck = !OddCheck;
                }
                ReadCnt++;
                
              }
              
                  
              //-----------------------------------------------------------------//
              //º¯ÊýÃû³Æ£º void TraceMode_Master_Write_Data(void)  
              //º¯Êý¹¦ÄÜ£º ´ÓIICBUF¶ÁÈ¡Êý¾Ý
              //ÊäÈë²ÎÊý£º ÎÞ
              //Êä³ö²ÎÊý£º ÎÞ
              //·µ »Ø Öµ£º ÎÞ
              //-----------------------------------------------------------------//
              #pragma disable
              void TraceMode_Master_Write_Data(void) 
              {   
                ReceData = IICBUF;
              }
              #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   ----    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.60.7.0   BF7615BMXX_XXXX_CTK_TRACE                                         04/10/2024 19:57:35 PAGE 6   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
